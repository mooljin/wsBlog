<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="diary">
	<select id="loadPost" parameterType="Integer" resultType="hashMap">
		SELECT POST_NUM, POST_CATEGORY, POST_TITLE, POST_DATE, POST_USER_NUM, POST_KEYWORDS
		  FROM POST_INFO
		 WHERE POST_NUM = #{postNum}
	</select>
	<select id="searchPost" parameterType="Map" resultType="hashMap">
		SELECT POST_NUM, POST_CATEGORY, POST_TITLE, POST_DATE, POST_USER_NUM, POST_KEYWORDS
		  FROM POST_INFO
		 WHERE ( POST_KEYWORDS LIKE CONCAT('%',#{postKeywords},'%') OR POST_TITLE LIKE CONCAT('%',#{postKeywords},'%') )
		   AND POST_USER_NUM = #{postUserNum}
		 <choose>
		 	<when test="postCategory != 'ALL'">
		   AND POST_CATEGORY = #{postCategory}
		 	</when>
		 </choose>
	</select>
	<select id="selectCategory" parameterType="Map" resultType="String">
		SELECT DISTINCT POST_CATEGORY
		  FROM POST_INFO
		 WHERE POST_CATEGORY = #{previousCategory}
		   AND POST_USER_NUM = #{postUserNum}
	</select>
	<update id="updateCategory" parameterType="Map">
		UPDATE POST_INFO
		   SET POST_CATEGORY = #{currentCategory}
		 WHERE POST_CATEGORY = #{previousCategory}
		   AND POST_USER_NUM = #{postUserNum}
	</update>
	<delete id="deleteCategory" parameterType="Map">
		DELETE FROM POST_INFO
		 WHERE POST_CATEGORY = #{previousCategory}
		   AND POST_USER_NUM = #{postUserNum}
	</delete>
</mapper>